webpackJsonp([13],{"4Q0E":function(e,t,o){(e.exports=o("FZ+f")(!1)).push([e.i,"\n.vcu-list-item[data-v-34f35fcd] {\n  cursor: pointer;\n}\n.vcu-list-item.selected[data-v-34f35fcd] {\n  background: #f0f0f0;\n}\n.split-wrap[data-v-34f35fcd] {\n  height: 750px;\n}\n.split-wrap .split-pane[data-v-34f35fcd] {\n  padding: 20px;\n}\n",""])},dnQb:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("woOf"),i=o.n(a),n=o("TVG1"),l={name:"project_index",data:function(){var e=this;return{listLoading:!1,projVisible:!1,projModalType:!0,paginationProj:{size:"small",simple:!0,total:1,onChange:function(t){e.onShowSizeChange(t)}},formProj:{projectname:""},ruleProj:{projectname:[{required:!0,message:"不能为空",trigger:"blur"},{pattern:/^(?!(\s+$))/,message:"不可为纯空格"}]},projectListData:[],selectedProject:"",searchModuleName:"",modModalType:!0,modleVisible:!1,pmidOptions:[],formModle:{modulename:"",pmid:"0"},ruleModle:{pmid:[{required:!0,message:"不能为空"}],modulename:[{required:!0,message:"不能为空",trigger:"blur"},{pattern:/^(?!(\s+$))/,message:"不可为纯空格"}]},splitVal:.3,tabledata:[],expandedRowKeys:[],loading:!1,columns:[{title:"模块名称",dataIndex:"modulename"},{title:"操作",width:"30%",scopedSlots:{customRender:"operation"},align:"center"}]}},mounted:function(){this.init()},methods:{init:function(){this.fetchProject(1)},fetchProject:function(e){var t=this;this.listLoading=!0,this.$request({method:"GET",url:"/projects",params:{page:e,pagesize:10}}).then(function(e){e&&(t.projectListData=e.data.rows,t.selectedProject=e.data.rows.length?e.data.rows[0].pid:"",t.paginationProj.total=e.data.totals,t.fetch(1)),t.listLoading=!1}).catch(function(e){t.listLoading=!1})},handleAddProjectClick:function(){this.projModalType=!0,this.projVisible=!0},handleProjOk:function(){var e=this;this.$refs.formproj.validate(function(t){if(t){var o={projectname:e.formProj.projectname},a="POST",i="/projects";e.projModalType?o.createtime=n.a.formatDate(new Date):(a="PATCH",i="/projects/"+e.formProj.pid),e.$request({method:a,url:i,data:o}).then(function(t){t&&(e.$message.success(t.message),e.fetchProject(1),e.handleProjCancel())})}else e.$message.error("验证失败!")})},handleProjCancel:function(){this.$refs.formproj.resetFields(),this.projVisible=!1},handleEidtProj:function(e){var t=this;this.projModalType=!1,this.projVisible=!0,this.$nextTick(function(){t.formProj=i()({},t.formProj,e)})},handleDeleteProj:function(e){var t=this;this.$confirm({title:"提示",content:"删除项目将会移除其下面所有的模块及接口且不可恢复",onOk:function(){t.$request({method:"POST",url:"/projects/delete",data:{id:e.pid}}).then(function(e){e&&(t.$message.success(e.message),t.fetchProject(1))})}})},handleSelectProj:function(e){this.searchModuleName="",this.selectedProject=e.pid,this.fetch(1)},onShowSizeChange:function(e){this.fetchProject(e)},fetch:function(e){var t=this;this.loading=!0,this.$request({method:"GET",url:"/modules",params:{modulename:this.searchModuleName,projectid:this.selectedProject,page:e,pagesize:10}}).then(function(e){var o,a;""==t.searchModuleName?(t.pmidOptions=(o=e.data.rows,a=[{label:"顶级模块",value:"0"}],o.forEach(function(e){0===e.pmid&&a.push({label:e.modulename,value:e.mid.toString()})}),a),t.tabledata=function e(t,o){for(var a=[],i=void 0,n=0;n<t.length;n++)if(t[n].pmid===o){var l=t[n];(i=e(t,t[n].mid)).length>0&&(i.forEach(function(e){e.child=!0}),l.children=i),a.push(l)}return a}(e.data.rows,0),t.expandedRowKeys=t.tabledata.map(function(e){if(e.children)return e.mid}).filter(function(e){return void 0!=e})):t.tabledata=e.data.rows,t.loading=!1})},handleTableChange:function(e,t,o){this.fetch(e.current)},handleAddModulesClick:function(){this.modModalType=!0,this.modleVisible=!0},onSearch:function(){this.fetch(1)},handleModleOk:function(){var e=this;this.$refs.formModle.validate(function(t){if(t){var o={modulename:e.formModle.modulename,projectid:e.selectedProject,pmid:parseInt(e.formModle.pmid)},a="POST",i="/modules";e.modModalType?o.createtime=n.a.formatDate(new Date):(a="PATCH",i="/modules/"+e.formModle.mid),e.$request({method:a,url:i,data:o}).then(function(t){t&&(e.$message.success(t.message),e.fetch(1),e.handleModleCancel())})}else e.$message.error("验证失败!")})},handleModleCancel:function(){this.$refs.formModle.resetFields(),this.modleVisible=!1},handleEidtModule:function(e){var t=this;this.modModalType=!1,this.modleVisible=!0,this.$nextTick(function(){e.pmid=e.pmid.toString(),t.formModle=i()({},t.formModle,e)})},handleView:function(e){this.$router.push({name:"interface_index",query:{pid:this.selectedProject,mid:e.mid}})},handleAddChildModule:function(e){this.modModalType=!0,this.modleVisible=!0,this.formModle.pmid=e.mid.toString()},handleDeleteModule:function(e){var t=this;this.$confirm({title:"提示",content:"删除模块将会移除其下面所有的接口且不可恢复?",onOk:function(){t.$request({method:"POST",url:"/modules/delete",data:{id:e.mid}}).then(function(e){e&&(t.$message.success(e.message),t.fetch(1))})}})}}},s={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("v-card",{attrs:{title:"项目列表",bodyStyle:{padding:"0px"}}},[o("div",{staticClass:"split-wrap"},[o("v-split",{model:{value:e.splitVal,callback:function(t){e.splitVal=t},expression:"splitVal"}},[o("div",{staticClass:"split-pane split-pane-left",attrs:{slot:"left"},slot:"left"},[o("div",{staticClass:"clearfix margin-bottom-15"},[o("v-button",{staticClass:"fr",attrs:{type:"primary",size:"small"},on:{click:e.handleAddProjectClick}},[e._v("新增")])],1),e._v(" "),o("v-list",{attrs:{dataSource:e.projectListData,loading:e.listLoading,bordered:"",size:"small",pagination:e.paginationProj},scopedSlots:e._u([{key:"renderItem",fn:function(t,a){return o("v-list-item",{key:"item.pid",class:{selected:t.pid==e.selectedProject},on:{click:function(o){e.handleSelectProj(t)}}},[o("v-button-group",{attrs:{slot:"actions",size:"small"},slot:"actions"},[o("v-button",{attrs:{icon:"edit"},on:{click:function(){return e.handleEidtProj(t)}}}),e._v(" "),o("v-button",{attrs:{icon:"delete"},on:{click:function(){return e.handleDeleteProj(t)}}})],1),e._v(" "),o("span",[e._v(e._s(t.projectname))])],1)}}])})],1),e._v(" "),o("div",{staticClass:"split-pane split-pane-right",attrs:{slot:"right"},slot:"right"},[o("div",{staticClass:"clearfix margin-bottom-15"},[o("div",{staticClass:"fl"},[o("v-input-search",{staticStyle:{width:"200px"},attrs:{placeholder:"模块名称",enterButton:"",size:"small"},on:{search:e.onSearch},model:{value:e.searchModuleName,callback:function(t){e.searchModuleName=t},expression:"searchModuleName"}})],1),e._v(" "),o("v-button",{staticClass:"fr",attrs:{type:"primary",size:"small"},on:{click:e.handleAddModulesClick}},[e._v("新增")])],1),e._v(" "),o("v-table",{attrs:{rowKey:function(e){return e.mid},indentSize:30,columns:e.columns,dataSource:e.tabledata,scroll:{y:500},pagination:!1,loading:e.loading,expandedRowKeys:e.expandedRowKeys,bordered:""},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"operation",fn:function(t,a,i){return[o("div",{staticClass:"editable-row-operations"},[o("v-button-group",{attrs:{size:"small"}},[a.child?e._e():o("v-button",{on:{click:function(){return e.handleAddChildModule(a)}}},[e._v("添加")]),e._v(" "),o("v-button",{on:{click:function(){return e.handleEidtModule(a)}}},[e._v("编辑")]),e._v(" "),o("v-button",{on:{click:function(){return e.handleDeleteModule(a)}}},[e._v("删除")]),e._v(" "),o("v-button",{on:{click:function(){return e.handleView(a)}}},[e._v("查看接口")])],1)],1)]}}])})],1)])],1)]),e._v(" "),o("v-modal",{attrs:{title:"项目名称",maskClosable:!1},on:{ok:e.handleProjOk,cancel:e.handleProjCancel},model:{value:e.projVisible,callback:function(t){e.projVisible=t},expression:"projVisible"}},[o("v-form",{ref:"formproj",attrs:{model:e.formProj,rules:e.ruleProj,"label-width":50}},[o("v-form-item",{attrs:{label:"名称",prop:"projectname"}},[o("v-input",{attrs:{type:"text"},model:{value:e.formProj.projectname,callback:function(t){e.$set(e.formProj,"projectname",t)},expression:"formProj.projectname"}})],1)],1)],1),e._v(" "),o("v-modal",{attrs:{title:"模块名称",maskClosable:!1},on:{ok:e.handleModleOk,cancel:e.handleModleCancel},model:{value:e.modleVisible,callback:function(t){e.modleVisible=t},expression:"modleVisible"}},[o("v-form",{ref:"formModle",attrs:{model:e.formModle,rules:e.ruleModle,"label-width":80}},[o("v-form-item",{attrs:{label:"上级模块",prop:"pmid"}},[o("v-select",{staticStyle:{width:"100%"},attrs:{options:e.pmidOptions},model:{value:e.formModle.pmid,callback:function(t){e.$set(e.formModle,"pmid",t)},expression:"formModle.pmid"}})],1),e._v(" "),o("v-form-item",{attrs:{label:"名称",prop:"modulename"}},[o("v-input",{attrs:{type:"text"},model:{value:e.formModle.modulename,callback:function(t){e.$set(e.formModle,"modulename",t)},expression:"formModle.modulename"}})],1)],1)],1)],1)},staticRenderFns:[]};var r=o("VU/8")(l,s,!1,function(e){o("jzId")},"data-v-34f35fcd",null);t.default=r.exports},jzId:function(e,t,o){var a=o("4Q0E");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);o("rjj0")("6e0ba1ba",a,!0,{})}});
//# sourceMappingURL=13.b7d49bf2074f01ee1756.js.map